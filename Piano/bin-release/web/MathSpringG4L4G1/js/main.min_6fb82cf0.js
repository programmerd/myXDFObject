var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{u(n.next(e))}catch(t){r(t)}}function a(e){try{u(n["throw"](e))}catch(t){r(t)}}function u(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(n){i=[6,n],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,r,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Index=function(e){function t(){var t=e.call(this)||this;return t.subNum=new Value(1),t.numberArr=[2,5,4,25,8,125,3,9],t.smallStart=[["Do","Do","So","So","La","La","So","Fa","Fa","Mi","Mi","Re","Re","Do","So","So","Fa","Fa","Mi","Mi","Re","So","So","Fa","Fa","Mi","Mi","Re"],["Mi","Mi","Mi","Fa","So","Mi","Re","Do","Do","Do","Re","Mi","Mi","Ti2","La2","Mi","Re","La2","Mi","Re","La2","Mi","Re","Do","Do"],["Mi","Mi","Re","Do","Re","Do","Ti2","La2","La2","La2","Fa","Fa","Mi","Re","Do","Re","Fa","Mi","Fa","Fa","Mi","Re","Re","Fa","Mi","Mi","Do","La2","La2","Ti2","Mi","Mi","Re","Do","Ti2","Do","La2"],["So","So","La","So","Do8","Ti","So","So","La","So","Re8","Do8","So","So","So8","Mi8","Do8","Ti","La","Fa8","Fa8","Mi8","Do8","Re8","Do8","Do8"],["Mi","Mi","So","La","Do8","Do8","La","So","So","La","So","So","So","So","Mi","So","La","La","So","Mi","Re","Mi","So","Mi","Re","Do","Do","Re","Do"],["Mi","Mi","Fa","So","So","Fa","Mi","Re","Do","Do","Re","Mi","Mi","Re","Re","Mi","Mi","Fa","So","So","Fa","Mi","Re","Do","Do","Re","Mi","Re","Do","Do"],["So","Do8","Re8","Mi8","Re8","Do8","Re8","So8","Mi8","Mi8","Fa8","So8","So8","So8","So8","So8","Mi8","Do8","So8","So8","So8","So8","So8","Mi8","Do8","Do8","Re8","Mi8","Mi8","Mi8","La8","Re8","Mi8","Re8","Do8","La","Do8"]],t.smallStartTime=[[0,.5,.5,.5,.5,.5,.5,1,.5,.5,.5,.5,.5,.5,1,.5,.5,.5,.5,.5,.5,1,.5,.5,.5,.5,.5,.5,1],[0,.5,.25,.25,.5,.5,1,1,.5,.25,.25,.5,.5,1,1,.5,.5,1,.5,.5,1,.5,.5,.75,.25,2],[0,1,.75,.25,.5,.5,.5,.5,1,1,1,1,.5,.5,.5,.5,.5,.5,1,1,.5,.5,1,.5,.5,1,.5,.5,1,1,1,.5,.5,.5,.5,.5,.5,1],[0,.5,.5,1,1,1,2,.5,.5,1,1,1,2,.5,.5,1,1,1,1,2,.5,.5,1,1,1,1,1],[0,1,.5,.5,.5,.5,.5,.5,1,.5,.5,2,1,1,1,.5,.5,1,1,2,1,.5,.5,1,.5,.5,1,.5,.5,2],[0,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.75,.25,1,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.75,.25,1],[0,.25,.25,.25,.25,.5,.25,.5,.5,1,.5,.5,.5,.25,.5,.25,.5,.25,.25,.5,.25,.5,.25,.5,.25,.25,.5,.25,.5,.25,.25,.5,.5,.125,.125,.25,.25,.25]],t.isMusic=!0,t.Do=RES.getRes("Do_mp3"),t.Do8=RES.getRes("Do+_mp3"),t.Re=RES.getRes("Re_mp3"),t.Re8=RES.getRes("Re+_mp3"),t.Mi=RES.getRes("Mi_mp3"),t.Mi8=RES.getRes("Mi+_mp3"),t.Fa=RES.getRes("Fa_mp3"),t.Fa8=RES.getRes("Fa+_mp3"),t.So=RES.getRes("So_mp3"),t.So8=RES.getRes("So+_mp3"),t.La=RES.getRes("La_mp3"),t.La2=RES.getRes("La-_mp3"),t.La8=RES.getRes("La+_mp3"),t.Ti=RES.getRes("Ti_mp3"),t.Ti2=RES.getRes("Ti-_mp3"),t.click=RES.getRes("click_mp3"),t.subTip=RES.getRes("subTip_mp3"),t.error=RES.getRes("error_mp3"),t.gq_bj=RES.getRes("bj_music_mp3"),t.pianos={dom:"keySetGroupAnimate",dragonbonesData:"Piano_ske_json",textureData1:"Piano_tex_json",texture1:"Piano_tex_png",name:"Piano",count:1},t.over={dragonbonesData:"gangqinjiemian_ske_json",textureData1:"gangqinjiemian_tex_json",texture1:"gangqinjiemian_tex_png",name:"over",count:1},t.gameover={dragonbonesData:"gangqinzhanshi_ske_json",textureData1:"gangqinzhanshi_tex_json",texture1:"gangqinzhanshi_tex_png",name:"gameover",count:1},t.gameover2={take:"over2",dragonbonesData:"zhanshi01_ske_json",textureData1:"zhanshi01_tex_json",texture1:"zhanshi01_tex_png",name:"over2",count:1},t.cursor={take:"tickling",dom:"keySetGroupAnimate",dragonbonesData:"anjianfankui_ske_json",textureData1:"anjianfankui_tex_json",texture1:"anjianfankui_tex_png",name:"fankui",count:1},t.skinName="IndexSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){var t=this;this.music.addEventListener(egret.TouchEvent.TOUCH_TAP,this.musicFun,this),this.reset.addEventListener(egret.TouchEvent.TOUCH_TAP,this.resetFun,this),e.prototype.childrenCreated.call(this),this.keySet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.keySetBtnFun,this),this.subNum.addEventListener(Data.DATA,this.changeNumFun,this),this.clickNum.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickNumFun,this),this.clickNum1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickNumFun,this),this.next.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickNext,this),this.prev.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickPrev,this),this.timu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.timuGroup.visible=!0},this),this.timuGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.timuGroup.visible=!1},this),this.tipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.tipGroup.visible=!0},this),this.tipGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.tipGroup.visible=!1},this),this.clickStart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.endStart.visible=!1,t.start()},this)},t.prototype.start=function(){this.changeNumFun(),this.music_bj=this.gq_bj.play(0,-1),this.playMusic("subTip"),this.tweenAnimate()},t.prototype.clickNext=function(){this.playMusic("click"),this.subNum.value+=this.subNum.value%2==0?1:2},t.prototype.clickPrev=function(){this.playMusic("click"),this.subNum.value-=this.subNum.value%2==0?1:2},t.prototype.changeNumFun=function(){var e=this;console.log("当前第几题：",this.subNum.value),this.shuject.source="sub"+this.subNum.value+"_png",this.subNum.value%2==0?this.start1.source="xing1_png":(this.start1.source="xing2_png",this.start2.source="xing2_png",this.gequ.source="gequ"+this.subNum.value+"_png"),this.subNum.value<=1?this.prev.visible=!1:this.subNum.value>=7?this.next.visible=!1:(this.prev.visible=!0,this.next.visible=!0),this.keyLabelGroup.$children.map(function(e){e.text=""});var t=this.keySet.$children;if(this.subNum.value>=7){this.clickNum.visible=!1,this.clickNum1.visible=!0;var i=this.clickNum1.$children.filter(function(i,n){return t[n].enabled=!0,i.visible=!0,i.source.split("_")[0]%e.numberArr[e.subNum.value-1]==0})}else{this.clickNum.visible=!0,this.clickNum1.visible=!1;var i=this.clickNum.$children.filter(function(i,n){return t[n].enabled=!0,i.visible=!0,i.source.split("_")[0]%e.numberArr[e.subNum.value-1]==0})}console.log(i);for(var n=i.length;n>0;n--){var o=this.keySet.$children.length,r=this.keySet.$children[o-n];r.enabled=!1}this.keyLabelCount=this.keySet.$children.length-i.length},t.prototype.clickNumFun=function(e){if("group"!=e.target.name){var t=e.target.source.split("_")[0];if(t%this.numberArr[this.subNum.value-1]==0){this.playMusic("click"),console.log(t);var i=this.keySet.getChildAt(this.keyLabelCount),n=this.keyLabelGroup.getChildAt(this.keyLabelCount);if(e.target.visible=!1,i.enabled=!0,n.text=t,this.keyLabelCount++,console.log(this.keyLabelCount,this.keySet.$children.length),this.keyLabelCount>=this.keySet.$children.length)if(this.subNum.value%2!=0)this.subNum.value++;else{var o=this.subNum.value/2-1,r=this.smallStartTime[o].reduce(function(e,t){return e+t});this.start2.source="xing1_png",this.overMask.visible=!0,this.overMask2.visible=!0,console.log("胜利界面"),this.pianos.count=Math.floor(r/2.33),this.gameover.count=Math.floor(r/2.1),this.gameover2.count=Math.floor(r/2.1);var s=this.animationFun(this.gameover);this.over2=this.animationFun(this.gameover2),console.log(s),s.x=0,s.y=0,s.scaleX=2,s.scaleY=2.2,this.over2.x=1e3,this.over2.y=0,this.over2.scaleX=2,this.over2.scaleY=2.2,this.animationFun(this.pianos),this.musicalNote()}}else this.playMusic("error"),console.log("->",t)}},t.prototype.keySetBtnFun=function(e){"group"!=e.target.name&&(this.playMusic(e.target.name),this.tickling=this.animationFun(this.cursor),this.tickling.x=e.target.parent.x+e.target.x-80,this.tickling.y=100,this.tickling.scaleX=2,this.tickling.scaleY=2)},t.prototype.tweenAnimate=function(){this.clickNum.$children.map(function(e){egret.Tween.get(e,{loop:!0}).to({scaleX:1.1,scaleY:1.1},500).to({scaleX:1,scaleY:1},500)}),this.clickNum1.$children.map(function(e){egret.Tween.get(e,{loop:!0}).to({scaleX:1.1,scaleY:1.1},500).to({scaleX:1,scaleY:1},500)}),this.yue.$children.map(function(e){egret.Tween.get(e,{loop:!0}).to({scaleX:.9,scaleY:.9},1e3).to({scaleX:1,scaleY:1},1e3)})},t.prototype.musicFun=function(){this.isMusic?(this.music_bj.stop(),this.isMusic=!1,this.music.source="music_close_png"):(this.music_bj=this.gq_bj.play(0,-1),this.isMusic=!0,this.music.source="music_png")},t.prototype.resetFun=function(){window.location.reload()},t.prototype.musicalNote=function(){function e(){console.log(n.smallStart[i][t]),n.playMusic(n.smallStart[i][t]),t++,clearInterval(o),console.log("--->",t,n.smallStart[i].length),t<n.smallStart[i].length&&(o=setInterval(e,1e3*n.smallStartTime[i][t]))}var t=0,i=this.subNum.value/2-1,n=this,o=setInterval(e,1e3*this.smallStartTime[i][t])},t.prototype.playMusic=function(e,t){return void 0===t&&(t=1),this.racTipMusic&&this.racTipMusic.stop(),this.racTipMusic=this[e].play(0,t),this.racTipMusic},t.prototype.animationFun=function(e){var t=this;this[e.take]&&this[e.take].parent&&(e.dom?this[e.dom].removeChild(this[e.take]):this.removeChild(this[e.take]));var i=RES.getRes(e.dragonbonesData),n=RES.getRes(e.textureData1),o=RES.getRes(e.texture1),r=new dragonBones.EgretFactory;r.parseDragonBonesData(i),r.parseTextureAtlasData(n,o);var s=r.buildArmatureDisplay(e.name);return e.dom?this[e.dom].addChild(s):this.addChild(s),s.animation.gotoAndPlayByFrame(e.name,1,e.count),s.addEventListener(dragonBones.EventObject.FRAME_EVENT,function(e){},this),s.addEventListener(dragonBones.EventObject.COMPLETE,function(){s.parent&&(e.dom?t[e.dom].removeChild(s):t.removeChild(s)),"gameover"==e.name&&(t.overMask.visible=!1,t.overMask2.visible=!1,t.over2.parent&&t.removeChild(t.over2))},this),s},t}(eui.Component);__reflect(Index.prototype,"Index",["eui.UIComponent","egret.DisplayObject"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.size=80,this.textField.width=1920,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="正在加载..."+Math.floor(e/t*100)+"%"},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=i.sent(),this.startAnimation(e),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return t=i.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return i.sent(),this.stage.removeChild(e),[3,5];case 4:return t=i.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=new Index;this.addChild(e)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,n=e.map(function(e){return i.parse(e)}),o=this.textfield,r=-1,s=function(){r++,r>=n.length&&(r=0);var e=n[r];o.textFlow=e;var i=egret.Tween.get(o);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,t)};s()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var u=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(n,generateJSON.paths[e])},this):RES.getResByUrl(u,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(n,generateJSON.paths[e])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Value=function(e){function t(t){var i=e.call(this)||this;return i._value=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){if(this._value!=e){this._value=e;var t=new Data(Data.DATA);this.dispatchEvent(t)}},enumerable:!0,configurable:!0}),t}(egret.EventDispatcher);__reflect(Value.prototype,"Value");var Data=function(e){function t(t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)||this}return __extends(t,e),t.DATA="valueChang",t}(egret.Event);__reflect(Data.prototype,"Data");var Keyset=function(e){function t(t,i,n){var o=e.call(this)||this;return o.skinName="KeysetSkin",o.cacl=t,o.x=0,o.y=0,console.log(i,n),o.keySetGroup.x=i,o.keySetGroup.y=n,o}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);for(var t=0;10>t;t++)this["key"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickKeyFun,this);this.cacl.clickLabel.text="",this.keyRevise.addEventListener(egret.TouchEvent.TOUCH_TAP,this.reviseFun,this),this.keyOk.addEventListener(egret.TouchEvent.TOUCH_TAP,this.submitFun,this),this.RectBj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.submitFun,this)},t.prototype.clickKeyFun=function(e){var t=e.target.source.split("_")[0];this.cacl.clickLabel.text.length<8&&(this.cacl.clickLabel.text+=t.split("key")[1])},t.prototype.reviseFun=function(e){this.cacl.clickLabel.text=""},t.prototype.submitFun=function(e){""!=this.cacl.clickLabel.text?this.cacl.clickLabel.text=parseInt(this.cacl.clickLabel.text)+"":this.cacl.clickLabel.text="输入",this.cacl.removeChild(this)},t}(eui.Component);__reflect(Keyset.prototype,"Keyset",["eui.UIComponent","egret.DisplayObject"]);